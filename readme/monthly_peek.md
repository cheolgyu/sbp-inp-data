# 피크월(거래량 기준)

## 목표
   이것의 목표는 손오공과 같이 특정 월에 몰리는 거래량을 가진 종목을 찾아서 매매할떄 참고하기 위함이다.   
   연도별 분기, 연도별 월, 연도별 주 단위로 구분하여 거래량이 몰리는 연도별 단위의 피크점를 찾은 후에 전체연도의 단위의 피크점과 연도별 단위의 피크점의 백분율을 구하여 백분율 순위 출력하기.


## 주요 용어
* 단위 구분   
  * 연도별 분기 quarter by year
  * 연도별 월 month by year
  * 연도별 주 weeks by year
* 단위의 피크점 unit peak


## 테이블
   - 저장테이블
     - 년도별 파티션

   | 종목id | 연도 | 단위구분 | 단위의 피크값 | 
   | ------ | ---- | -------- | ------------- | 

   - 통계뷰
   
  | 종목id | 단위구분 | 전체연도 단위의 피크값 | 전체연도 단위의 피크값 범위 | 퍼센트 |
  | ------ | -------- | ---------------------- | --------------------------- | ------ |
  

## 실행주기 파이프라인

   - 매일 입력되는 데이터 기준으로? 
     - 입력 데이터가 현재의 것이라면
       - 현재 데이터와 연관된 단위의 테이블값을 수정함.
     - 입력 데이터가 과거의 것이라면
       - 과거 시점부터 현재까지의 데이터까지 연관된 단위의 테이블값을 수정함.
   - 저장테이블을 기준으로?
 
  
  





## 방법2
0. vscode를 켠다. 
1. 쿼리를 짠다.
   1. meta.code에 해당되는 tb_monthly_peek의  기준칼럼(마지막 저장일)을 찾아서 계산해서 넣기
      1. meta.code와 tb_monthly_peek의 기준칼럼(마지막 저장일)을 조회
         1. table 생성 tb_monthly_peek tbmp, tb_monthly_peek_volume tbmpv
            1. 차이점: 
               1. tbmp는 매일 업데이트된 tbmpv의 거래럍을 가지고 정보를 도출한다.
               2. tbmpv는 단순히 매일 거래량을 업데이트한다.  
         2. tbmp     => 종목의 연도별 피크월, 사용자 조회= 마지막 테이블 
         3. tbmpv    => 년도의 월별 거래량합, tb_monthly_peek의 보조
            1. 종목코드, 년도, 월, 거래량, 마지막계산일
            2. 장마감시 거래량 업데이트 용


         4. 매일 tb_mpv의 년도의 월에 vol 추가하고
         5. tb_mp에 종목의 해당년도의 값 업데이트 하기.
         6. 
      2. 시작기준 부터 hist.price 조회
      3. 조회 결과 golang으로 계산
      4. insert
2. 맞나 확인한다.
3. 테이블 저장: 코드의 전체년도의 피크월 존재, 피크월, 주변월, 전체월.json{월: 퍼센트} 
4. 뷰 저장: select count(피크월) group by 피크월  count 가 1이면 피크윌이 공통값.   
    where row수가  1이 아니것의 의미는 => 여러 년도를 비교한것. 그러므로 조회에서 로우수도 조회

## 계산 범위
현재 입력된 달은 매일 갱신.   
매일 테이블을 갱신 시켜줌. 해당년도의 달만.    
하루에 2번 실행 될 되도 문제없게.  

## 실행시작
가격다 넣고 반등 계산하고.   
종목별 마지막 가격일 조회 해서 가격일 갱신하면 이전 피크월은 계산이 안됨.   

피크월 테이블 기준으로 시작하기 vs 가격 테이블 기준 시작하기   
종목의 마지막 년도 피크월이 있으면? ( 년도포함월 칼럼추가. )    
