
DROP SCHEMA IF EXISTS "utils" CASCADE;
CREATE SCHEMA "utils";
------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------
----------------------------------------
----------------------------------------
----------------------------------------
----------------------------------------
----------------------------------------
----------------------------------------
--  o2c l2c 계산 함수

--  select * from public.get_o2c(op,cp);

----------------------------------------
----------------------------------------
----------------------------------------
----------------------------------------
----------------------------------------
CREATE or replace FUNCTION utils.get_o2c(op numeric, cp numeric)
RETURNS  numeric AS $$
BEGIN 
RETURN  (select round((cp-op)/NULLIF(op,0) *100,2) );
END;  $$
LANGUAGE plpgsql;
--select * from utils.get_o2c(10,20);

----------------------------------------
----------------------------------------
----------------------------------------
----------------------------------------
----------------------------------------
----------------------------------------
-- 전체값에서 일부값은 몇 퍼센트? 계산법 공식
-- 일부값 ÷ 전체값 X 100
--  select * from utils.get_percent(part,total);

----------------------------------------
----------------------------------------
----------------------------------------
----------------------------------------
----------------------------------------
CREATE or replace FUNCTION utils.get_percent(part numeric, total numeric)
RETURNS  numeric AS $$
BEGIN 
RETURN  (select NULLIF(part,0)/NULLIF(total,0) *100 );
END;  $$
LANGUAGE plpgsql;
--select * from public.get_percent(10,20);
------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------


CREATE TABLE "utils"."log" (
    "id" serial NOT NULL,
    PRIMARY KEY ("id"),
    "state" text NOT NULL,
    "content" text NOT NULL
);  




--  remove.price_stock  분기 추가 
-- ALTER TABLE remove.price_stock ADD COLUMN q4 numeric(1,0);

-- update remove.price_stock t
-- set (q4) = (
-- 	select   case  when mm < 4 then 1 when mm < 7 then 2  when mm < 10 then 3 else 4 end as q4
-- 	from remove.price_stock where code = t.code and p_date = t.p_date
-- );


